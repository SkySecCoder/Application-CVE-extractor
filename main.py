#!/bin/python -

import os
import sys
import json
import urllib2

def main():
	extractCVE()
	removeDuplicates()

def removeDuplicates():
	flag = 0 
	count = 1
	data = []
	file = open("output.csv","r")
	for line in file.readlines():
		pot = line.split(",")[0]
		if flag == 0:
			temp = pot
			flag += 1
		else:
			if temp != pot :
				temp = pot
				data.append(line)
				count += 1
	file.close()
	file = open("output2.csv","w")
	for item in data:
		file.write(item)		
	file.close()		

def extractCVE():
	versions = []
	tools = []
	toolspcve = []
	flag = 0
	temp1 = ""
	i = 0
	while i < 10:
		versions.append(" "+str(i))
		i += 1
	
	file = open("main.csv", "r")
	for line in file.readlines():
		ltd = line.replace("\n","")
		ltd = ltd.replace(".app","")
		ltd = ltd.replace(".App","")
		ltd = ltd.replace(".exe","")
		ltd = ltd.replace("\r","")
		for item in versions:
			if item in ltd:
				ltd = ltd.split(item)[0]
				break
		ltd = ltd.split("(")[0]
		ltd = ltd.replace(" ","_")
		tools.append(ltd)
	file.close()
 
 	genurl = "http://cve.circl.lu/api/search/"
	
	for item in tools:
		flag = 0
		for top in toolspcve:
			if item in top:
				flag = 1
		if flag == 0:
			#print item,
			response = urllib2.urlopen(genurl+item)
			data = json.loads(response.read())
			i = 0
			#temp = item.replace("\n","")
			temp1 = item+','
			for opt in data["data"]:
				try:
					temp1 += data["data"][i]["id"]+":"+str(data["data"][i]["cvss"])+"   "
				except:
					temp1 += data["data"][i]["id"]+"   "
				i += 1
			print temp1
			toolspcve.append(str(temp1))
			temp1 = ""

	file = open("output.csv","w")
	for item in toolspcve:
		file.write(item+"\n")
	print "Finish..."
	file.close()

if __name__ == "__main__":
	main()